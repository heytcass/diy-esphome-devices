# Sendspin Artwork Role - Image display (album art)
#
# "displays artwork images" with support for multiple display channels
#
# Provides:
#   - sendspin_cover_art image component
#   - Debounced refresh script for display updates
#
# Substitutions:
#   - cover_art_size: e.g., "600x600" or "720x720"
#   - debounce_delay: e.g., "5s" (e-ink) or "500ms" (LCD)
#   - display_id: e.g., "eink_display" or "tab5_display"
#
# Requires: metadata.yaml (for is_playing global and track_title on_value)

# Album art from Sendspin
generic_image:
  - platform: sendspin
    id: sendspin_cover_art
    format: jpg
    type: rgb565
    resize: ${cover_art_size}
    image_source: ALBUM
    on_image_decoded:
      - script.execute: debounced_refresh
    on_image_error:
      - logger.log: "Failed to decode cover art image"

# Debounce state
globals:
  - id: pending_refresh
    type: bool
    restore_value: no
    initial_value: "false"

# Debounced refresh script - prevents rapid display updates
script:
  - id: debounced_refresh
    mode: restart
    then:
      - globals.set:
          id: pending_refresh
          value: "true"
      - delay: ${debounce_delay}
      - globals.set:
          id: pending_refresh
          value: "false"
      - component.update: ${display_id}
      - logger.log: "Display refreshed after debounce"
